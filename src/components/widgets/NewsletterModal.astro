---
interface Props {
  title?: string;
  description?: string;
  logoSrc?: string;
  subscriberCount?: string;
}

const {
  title = 'CTO4.AI',
  description = 'AI-focused insights and expertise for technology leaders. Practical guidance for CTOs navigating the AI transformation.',
  logoSrc = '~/assets/images/default.png',
  subscriberCount = 'Join 1,000+ technology leaders'
} = Astro.props;
---

<div id="newsletter-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white dark:bg-gray-900 rounded-lg shadow-xl max-w-md w-full mx-4 relative">
    <!-- Close button -->
    <button
      id="modal-close"
      class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl font-light"
      aria-label="Close modal"
    >
      ×
    </button>
    
    <!-- Modal content -->
    <div class="p-8 text-center">
      <!-- Logo placeholder -->
      <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg mx-auto mb-6 flex items-center justify-center">
        <span class="text-white font-bold text-xl">C4</span>
      </div>
      
      <!-- Title -->
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-3">
        {title}
      </h2>
      
      <!-- Description -->
      <p class="text-gray-600 dark:text-gray-300 mb-2 leading-relaxed">
        {description}
      </p>
      
      <!-- Subscriber count -->
      <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
        {subscriberCount}
      </p>
      
      <!-- Email form -->
      <form id="newsletter-form" class="space-y-4">
        <div class="flex gap-2">
          <input
            type="email"
            placeholder="Type your email..."
            required
            class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-white"
          />
          <button
            type="submit"
            class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md transition-colors"
          >
            Subscribe
          </button>
        </div>
      </form>
      
      <!-- Terms -->
      <p class="text-xs text-gray-500 dark:text-gray-400 mt-4">
        By subscribing, I agree to the 
        <a href="/terms" class="underline hover:text-gray-700 dark:hover:text-gray-300">Terms of Use</a> and 
        <a href="/privacy" class="underline hover:text-gray-700 dark:hover:text-gray-300">Privacy Policy</a>
      </p>
      
      <!-- No thanks -->
      <button
        id="modal-dismiss"
        class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 text-sm mt-6 block mx-auto"
      >
        No thanks →
      </button>
    </div>
  </div>
</div>

<script>
  // Modal functionality
  const modal = document.getElementById('newsletter-modal');
  const closeBtn = document.getElementById('modal-close');
  const dismissBtn = document.getElementById('modal-dismiss');
  const form = document.getElementById('newsletter-form');
  
  // Check if modal should be shown
  function shouldShowModal() {
    const hasSeenModal = localStorage.getItem('cto4ai-newsletter-modal-seen');
    const hasSubscribed = localStorage.getItem('cto4ai-newsletter-subscribed');
    return !hasSeenModal && !hasSubscribed;
  }
  
  // Show modal
  function showModal() {
    if (modal && shouldShowModal()) {
      setTimeout(() => {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }, 2000);
    }
  }
  
  // Hide modal
  function hideModal() {
    if (modal) {
      modal.classList.add('hidden');
      document.body.style.overflow = '';
      localStorage.setItem('cto4ai-newsletter-modal-seen', 'true');
    }
  }
  
  // Handle form submission
  function handleSubmit(e) {
    e.preventDefault();
    const email = e.target.querySelector('input[type="email"]').value;
    
    // TODO: Integrate with Beehiiv or newsletter service
    console.log('Newsletter signup:', email);
    
    localStorage.setItem('cto4ai-newsletter-subscribed', 'true');
    hideModal();
    
    // Show success message
    alert('Thanks for subscribing! You\'ll receive our newsletter soon.');
  }
  
  // Event listeners
  if (closeBtn) closeBtn.addEventListener('click', hideModal);
  if (dismissBtn) dismissBtn.addEventListener('click', hideModal);
  if (form) form.addEventListener('submit', handleSubmit);
  
  // Close on outside click
  if (modal) {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) hideModal();
    });
  }
  
  // Show modal on page load
  document.addEventListener('DOMContentLoaded', showModal);
</script>