---
import type { HTMLAttributes } from 'astro/types';
import { Image } from 'astro:assets';

interface Props {
  src: string;
  alt?: string;
  size?: 'sm' | 'md' | 'lg' | 'xl' | '2xl';
  class?: string;
  postDir?: string;
  basePath?: string;
}

const { src, alt = '', size = 'lg', class: className = '', postDir = 'chatgpt-4v', basePath = '../../assets/images/blog' } = Astro.props;

const sizeClasses = {
  sm: 'max-w-sm',
  md: 'max-w-md', 
  lg: 'max-w-lg',
  xl: 'max-w-xl',
  '2xl': 'max-w-2xl'
};

// Import the image dynamically with fallback support
let imageModule;

// Try new unified content path first
const newBasePath = '../../assets/images/content';
const oldBasePath = basePath || '../../assets/images/blog';

// Try new path first
try {
  const newImagePath = postDir ? `${newBasePath}/${postDir}/${src}` : `${newBasePath}/${src}`;
  imageModule = await import(newImagePath);
} catch (newError) {
  // Fallback to old path
  try {
    const oldImagePath = postDir ? `${oldBasePath}/${postDir}/${src}` : `${oldBasePath}/${src}`;
    imageModule = await import(oldImagePath);
  } catch (oldError) {
    console.error(`Failed to load image: ${src} from both new and old paths`, { newError, oldError });
    imageModule = null;
  }
}
---

{imageModule && (
  <div class={`single-image ${sizeClasses[size]} mx-auto ${className}`}>
    <a 
      href={imageModule.default.src}
      class="glightbox block"
      data-gallery="gallery"
      data-title={alt}
    >
      <Image 
        src={imageModule.default}
        alt={alt}
        class="w-full h-auto rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer"
        loading="lazy"
        width={800}
        height={600}
      />
    </a>
  </div>
)}


<style>
  .single-image {
    margin: 2rem auto;
  }
  
  .glightbox {
    display: block;
    transition: transform 0.2s ease;
  }
  
  .glightbox:hover {
    transform: scale(1.02);
  }
</style>