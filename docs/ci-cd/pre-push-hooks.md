# Pre-Push Hooks

This document explains the git pre-push hooks that run before code can be pushed to GitHub.

## Overview

The repository uses git hooks to ensure code quality before pushing to GitHub. This prevents CI failures and maintains code quality standards.

## What Runs Before Push

When you run `git push`, the pre-push hook automatically runs:

### 1. `npm run check`

This runs three checks in sequence:

```bash
npm run check:astro   # Astro + TypeScript validation
npm run check:eslint  # Code quality and style rules
npm run check:prettier # Code formatting validation
```

#### Astro Check

- Validates Astro components
- Checks TypeScript types
- Reports errors and warnings
- Must have **0 errors** to pass (warnings are OK)

#### ESLint

- Enforces code quality rules
- Checks for common issues
- Must pass with **no errors**

#### Prettier

- Validates code formatting
- Checks all file types: `.js`, `.ts`, `.astro`, `.md`, `.mdx`, etc.
- Must report: "All matched files use Prettier code style!"

### 2. `npm run build`

- Builds the entire site for production
- Ensures no build errors
- Verifies all imports and dependencies
- Must complete successfully

## Common Failure Causes

### TypeScript Errors

**Symptoms:**

```
error ts(2339): Property 'foo' does not exist on type 'Bar'
```

**Common causes:**

- Using non-existent properties (e.g., `post.data.date` when only `post.data.publishDate` exists)
- Missing type definitions
- Wrong types imported

**Fix:**

1. Check the actual type definition
2. Use correct property names
3. Add proper TypeScript types

### ESLint Errors

**Symptoms:**

```
error: Unexpected any @typescript-eslint/no-explicit-any
error: 'foo' is assigned a value but never used @typescript-eslint/no-unused-vars
```

**Fix:**

1. Use proper types instead of `any`
2. Remove unused variables
3. Add ESLint disable comments if necessary:

```typescript
// eslint-disable-next-line @typescript-eslint/no-explicit-any
const foo: any = dynamicValue;
```

### Prettier Formatting Errors

**Symptoms:**

```
[warn] src/data/content/my-post/index.mdx
[warn] Code style issues found in the above file. Run Prettier with --write to fix.
```

**Fix:**

```bash
# Auto-fix all formatting issues
npm run fix:prettier

# Or format specific file
npx prettier --write src/data/content/my-post/index.mdx
```

**Prevent:** Enable format-on-save in VSCode (see [prettier-auto-formatting.md](./prettier-auto-formatting.md))

### Build Errors

**Symptoms:**

```
error: Cannot find module './missing-file'
error: Image not found at path
```

**Common causes:**

- Missing imports
- Broken file paths
- Missing images or assets
- Syntax errors in MDX files

**Fix:**

1. Verify all imports exist
2. Check file paths are correct
3. Ensure all referenced images exist in correct location
4. Validate MDX syntax

## Manual Testing

Run the same checks locally before pushing:

```bash
# Run all checks
npm run check

# Run individual checks
npm run check:astro
npm run check:eslint
npm run check:prettier

# Test the build
npm run build

# Auto-fix formatting issues
npm run fix:prettier
```

## Bypassing Hooks (Not Recommended)

You can bypass pre-push hooks with:

```bash
git push --no-verify
```

**⚠️ Warning:** This is **strongly discouraged** because:

- CI will still fail on GitHub
- You'll waste time waiting for failed builds
- Other team members may pull broken code
- The whole point of hooks is to catch issues early

## If Push is Blocked

1. **Read the error message carefully** - it tells you exactly what's wrong
2. **Fix the reported issues**
3. **Run `npm run check` locally** to verify fixes
4. **Try pushing again**

Example workflow:

```bash
# Push fails
git push

# Output shows prettier error in some-file.md
# Fix it
npm run fix:prettier

# Verify everything passes
npm run check

# Try again
git push
```

## Hook Configuration

The pre-push hook is configured in `.git/hooks/pre-push` (auto-generated by the project setup).

If hooks aren't working:

1. Ensure you've run `npm install` (sets up hooks)
2. Check `.git/hooks/pre-push` exists and is executable
3. Run `chmod +x .git/hooks/pre-push` if needed

## Benefits of Pre-Push Hooks

- **Catch issues early** - before CI runs
- **Faster feedback** - local checks are quicker than waiting for CI
- **Prevent broken builds** - ensures main branch stays clean
- **Save time** - no waiting for failed CI builds
- **Better git history** - fewer "fix formatting" commits

## Related Documentation

- [Prettier Auto-Formatting](./prettier-auto-formatting.md) - Set up auto-format on save
- [CI/CD Pipeline](./ci-cd-pipeline.md) - What runs on GitHub after push
